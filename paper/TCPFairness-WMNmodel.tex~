\documentclass[10pt, conference]{IEEEtran}

% \usepackage{hyperref}	%To get rid of EDAS warning: External links are not allowed
\usepackage{amsmath}
%\pdfpagewidth=8.5in
%\pdfpageheight=11in
\usepackage{graphicx}
\usepackage{array}                 % nicer looking arrays?
\usepackage{cite}
\usepackage{url}
\usepackage{multirow} 		% multiple rows in a table
%\usepackage{subfigure}
\usepackage{subfig}
\usepackage{color,latexsym,amsfonts,amssymb}
\usepackage{bm} %use \bm instead of \mathbf

\makeatletter
\def\ps@headings{%
\def\@oddhead{\mbox{}\scriptsize\rightmark \hfil \thepage}%
\def\@evenhead{\scriptsize\thepage \hfil \leftmark\mbox{}}%
\def\@oddfoot{}%
\def\@evenfoot{}}
\addtolength\textfloatsep{-3ex}

\title{Timestamp-ordered MAC for TCP Fairness in Wireless Mesh Networks}

\author{\authorblockN{Faisal Nawab\authorrefmark{1}, Kamran Jamshaid\authorrefmark{1}, Basem Shihada\authorrefmark{1}, and Pin-Han Ho\authorrefmark{2}}
\authorblockA{\authorrefmark{1} MCSE Division, KAUST, Saudi Arabia, \{faisal.nawab, kamran.jamshaid, basem.shihada\}@kaust.edu.sa}
\authorblockA{\authorrefmark{2} Dept. of Electrical and Computer
Engineering, University of Waterloo, Canada, {pinhan}@bbcr.uwaterloo.ca}
}

\begin{document}

\maketitle

\begin{abstract}
In this paper we study the interactions of TCP and IEEE 802.11 MAC in Wireless Mesh Networks (WMNs). We use a Markov chain to capture the behavior of TCP sessions, particularly the impact on network throughput performance due to the effect of queue utilization and packet relaying. A closed form solution is derived to numerically determine the throughput. Based on the developed model, we propose a distributed MAC protocol called Timestamp-ordered MAC (TMAC), aiming to alleviate the unfairness problem in WMNs via a manipulative per-node scheduling mechanism which takes advantage of the age of each packet as a priority metric. Simulation is conducted to validate our model and to illustrate the fairness characteristics of TMAC. We conclude that TMAC can achieve fairness with only little impact on network capacity.
\end{abstract}

\begin{keywords}
Wireless Mesh Networks, 802.11, TCP, fairness
\end{keywords}

\section{Introduction}\label{sec:Intro}
Wireless Mesh Networks (WMNs) have emerged to meet a need for a self-organized and self-configured wireless network infrastructure. Low cost infrastructure and ease of deployment have made WMNs an attractive technology for last mile access. A typical WMN uses stationary or mobile Mesh Points (MPs) to form a multi-hop wireless network. End-user client devices connect to a local MP, and then the launched packets are relayed through the multi-hop backhaul. Some of these MPs are connected to the public Internet and act as gateway mesh routers which bridge traffic between the wired and the wireless networks.

Multi-hop wireless networks, including WMNs, exhibit flow rate unfairness among competing nodes. With backlogged traffic, the impact of flow unfairness can be significant and can lead to starvation for flows two or more hops away from the gateway. This problem is observed even with TCP, which is designed for fair allocation of network resources. A better understanding of the interaction between TCP congestion control algorithm and IEEE 802.11 MAC in a WMN is important to address the fairness problem. An analytical model that successfully predicts TCP flow characteristics can isolate the causes of such performance degradation. However, this is a challenging task since multi-hop wireless networks are subject to losses from collisions as well as random channel noise, which may eventually degenerate to the point of starvation.

In this paper we propose an analytical model that captures the behavior of competing TCP flows in a 802.11-based WMN.  Our model uses the cumulative number of TCP data packets in the network for a given TCP flow. These are the packets generated by that flow but not yet delivered to the destination. At any given time, these packets are distributed over various queues along the path between the source and destination. For simplicity, we model the network as a closed system where the state of a flow is represented by the cumulative number of data packets existing in the network for a particular flow (called the cumulative network queue). Furthermore, our model uses the number of transmissions required by a particular flow from the perspective of the gateway (called the transmission step). Since transmissions beyond the carrier sense range of the gateway can be made concurrently while the gateway is transmitting, the transmission step for the majority of the nodes in a network varies between 1 and 3.

There has been a significant amount of research done for modeling wireless links characteristics. This include models for describing the detailed behavior of random access protocols in wireless networks~\cite{NAbramson70,GBianchi00}. These studies, however, assume that all nodes are fully aware of the network state, which is only feasible in the presence of additional signaling mechanisms on top of a distributed 802.11 WMN. Multi-hop wireless network models have also been proposed in~\cite{MGaretto08, RBoorstyn87} and~\cite{VGambiroza04}. These models capture the MAC protocol interactions by assuming a connection-less backlogged traffic. Other models account for TCP traffic by considering the impact of an extra flow caused by the acknowledgment (ACK) packets. However, rather than capturing the interaction of TCP and MAC, these studies model the aftermath of these interactions. Some previously proposed models capture the interaction of MAC and TCP in wireless networks~\cite{SPilosof03, AKherani04}. We are mainly interested in the objective of~\cite{AKherani04}, where the effect of multi-hop relaying and TCP data/ACK packets exchange are explicitly modeled. However, the work in~\cite{AKherani04} only considers a two-hop chain topology with a single flow with a conservative choice of TCP congestion window. The intractability of this limits its analysis to more reasonable multi-hop scenarios. However, in this paper, we focus on larger WMNs topologies with a larger number of flows. Thus, we maintain the objective of the work in~\cite{AKherani04} with a more tractable model that is applicable to more complex scenarios.

The remainder of this paper is organized as follows: Our proposed model is described in Section~\ref{sec:model}, including a discussion of the causes of unfairness. In Section~\ref{sec:TMAC} we propose TMAC, a MAC layer protocol that addresses the fairness challenges identified in the model. We validate our model in Section~\ref{sec:eval}. Furthermore, we present a simulation study of performance analysis of TMAC. We conclude with a discussion and a summary in Section~\ref{sec:conclusions}.

\section{Modeling TCP in WMNs}\label{sec:model}
In this section we model TCP flows over 802.11-based WMNs. An investigation of the necessary parameters to capture the TCP flow's characteristics is presented followed by a methodology for constructing a Markov chain to model these parameters. The causes of TCP unfairness are highlighted and further analyzed.

\subsection{Overview}
We model TCP flows in WMNs while focusing on the fairness characteristics. Without loss of generality, our model considers a single mesh gateway. We assume that all nodes have backlogged TCP traffic destined to the gateway and the TCP streams are in a state of equilibrium ({\em i.e.,} the flow rate characteristics are stable over time). Similar to~\cite{AKherani04}, we start by fixing the upper bound TCP's congestion window size. Later in this section, we investigate the effect of varying this limit on the rate of a flow.

Our model groups flows into a bundle that share a common queue at one-hop nodes from the gateway. We represent each such bundle as a \emph{branch}. The relationship between resources allocated for different branches is dictated by the random access behavior of the MAC protocol. With 802.11 CSMA/CA MAC, nodes around the gateway have equal probability of accessing the channel, and thus each branch receives an equal share of the resources. For example, if two nodes, $A$ and $B$, are in the transmission range of the gateway, the resources allocated for nodes in the branch sharing queue $A$ is equal to the amount allocated to nodes sharing branch $B$ despite the difference in the respective number of nodes.

Given the assumptions above, the parameters necessary for modeling TCP throughput are the utilization of the network queues at various nodes and the order of packets in the queues (relative to their source and destination) for both data and ACK packets. However, deriving a closed form solution would be hard in the presence of topologies with a larger number of nodes and active flows. Thus, the following two assumptions are introduced to simplify the problem. First, we model the queue utilization without considering the order of the packets; in other words, only the number of packets for each flow is taking into account, while the order is then considered by calculating possible permutations and assigning the transition probabilities accordingly. Second, by observing the behavior of single sink networks, we found that the queue belonging to the closest node to the gateway exhibits significant utilization. Thus, we model the cumulative network queue. The multi-hop effect is modeled by assigning the transition probabilities according to the number of necessary transmission steps in the network. Number of transmission steps is correlated with the cumulative wait times experienced by packets.


\subsection{The Model}
A Markov chain is used to model the TCP behavior. The system state is represented by the cumulative network queue utilization. Each state represents the number of data packets for each flow in the queue. Thus, for a 2-hop parking lot topology we describe the network as the process \begin{math} \{ P_1, P_2 \} \end{math}, where $P_n$ indicate the number of data packets belonging to the $n^{th}$ flow that exist in the network ({\em i.e.,} $P_1$ and $P_2$ represent the number of packets queued for the 1 and 2-hop flows). The model is a Markov chain with \emph{n}-dimensions, where \emph{n} is the number of flows. We use \begin{math} W_n \end{math} to denote the TCP congestion window of the \begin{math} n^{th} \end{math} flow. Thus an equivalent state description of the network is the number of ACK packets in the network, \emph{i.e.,} the process \begin{math} \{ W_1 - P_1, W_2 - P_2 \} \end{math}.
State transitions are governed by three aspects: (1) the number of nodes competing for channel access; (2) the relative number of data and ACK packets in the network, which is further coupled with the probability of accessing the channel; and (3) the multi-hop effect, which is further modeled as additional self loops with an equal share of the transition probability of the original link. We assume that all nodes have an equal chance to access the channel. This assumption holds given that we only model the cumulative network queue. Note that the number of self loops corresponds to the number of transmission steps which in turn affects the cumulative network queues. For example, in a 2-hop parking lot topology a data transmission of a packet belonging to flow 2 is represented as a transition from state \begin{math} \{ P_1, P_2 \} \end{math} to state \begin{math} \{ P_1, P_2 - 1 \} \end{math} with probability
\begin{displaymath}
\frac{P_2}{k_2.l_{\{P_1, P_2\}}.(P_1 + P_2)}
\end{displaymath}
where $l_{\eta}$ is the number of stations competing for the channel for a given state, \emph{e.g.} $\eta = \{P_1, P_2\}$. $k_j$ is the number of transmission steps needed for flow $j$.

\begin{figure*}[t]
\centering
\includegraphics[scale=0.55]{img/STD2.eps}
\caption{Transition diagram for two-hop parking lot topology. Congestion windows for the farthest and closest flow are $M$ and $N$ respectively. The state $(P_1, P_2)$ denotes that the network has $P_1$ data packets for flow 1 and $P_2$ data packets for flow 2, where a upward transition corresponds to the transmission of a data packet of flow 1, a downward transition is for an ACK transmission of flow 1, a leftward transition is for the transmission of a data packet of flow 2, and a rightward transition corresponds to an ACK transmission of flow 2}

\label{fig:STD2}
\end{figure*}

We summarize the possible transmissions for a packet belonging to flow \emph{i} as follows,

\begin{itemize}
\item{\emph{Data Packet:} Transition from state \begin{math} \{ P_1, \ldots ,P_i ,\ldots\} \end{math} to \begin{math} \{ P_1, \ldots, P_i - 1, \ldots\} \end{math} with probability \begin{math} \frac{P_i}{k_i.l_{\eta}.(\sum_{j}^{n}{P_j)}} \end{math}, given that \begin{math} P_i > 0 \end{math}.}
\item{\emph{ACK Packet:} Transition from state \begin{math} \{ P_1, \ldots ,P_i ,\ldots\} \end{math} to \begin{math} \{ P_1, \ldots, P_i + 1, \ldots\} \end{math} with probability \begin{math} \frac{W_i - P_i}{k_i.l_{\eta}.(\sum_{j}^{n}{(W_j-P_j))}} \end{math}, given that \begin{math} (W_i - P_i) > 0 \end{math}.}
\end{itemize}

The assignment of the number of competing nodes is as follows,
\begin{itemize}
\item{\begin{math} l_{\eta} = 1 \end{math}, given that \begin{math} \sum_{j}^{n}{P_j} = 0 \end{math} or \begin{math} \sum_{j}^{n}{P_j} = \sum_{j}^{n}{W_j} \end{math}.}
\item{\begin{math} l_{\eta} = 2 \end{math}, otherwise.}

\end{itemize}

From the above we observe that the number of competing nodes is highly affected by the existence of data/ACK packets in the cumulative network queue. The number of transmissions necessary for a packet (\emph{i.e., $k_j$}) determines the number of transmission steps affecting the modeled queues. In other words, transmissions that do not contribute to the relative utilization of the cumulative network queue are discarded and not considered. This is as a result of our earlier observation that the queues closer to the gateway have significantly higher utilization than that of the other queues. Unless mentioned otherwise, in the rest of our discussion we assume that $k_j$ equals to 1 for flows originating from any one-hop away node, and 2 otherwise. Figure~\ref{fig:STD2} shows a generalization of the transition diagram of a 2-hop parking lot topology.

\subsection{Model Analysis}
\label{sub:study}
Relative throughput of participating flows is an important performance metric for our study. We examine a network with \emph{n} flows, \emph{i.e.} $J =$ $1$,\ldots,$j$,\ldots,$n$. The local symmetry exhibited in the model allows us to calculate the probability of a state by transition from state $P_{0, \ldots, 0}$ to the desired state through each dimension. We assume that $ I = \{ i_1, \ldots, i_j, \ldots, i_n \}$ is the state we want to study. First, we introduce the following formula to calculate the intensities of traversal in dimension~$j$,


\begin{equation}
\label{eq:onedimension}
\phi_{j, i_j} = \prod_{X=0}^{i_j-1} [ (\frac{(W_{j} - X)}{l_{\eta_a}.(\sum_w^n{W_{w}} - X - \alpha_{j})}) / (\frac{(X + 1)}{l_{\eta_d}.(X + 1 + \alpha_{j})}) ]
\end{equation}

The first term corresponds to the probability of an ACK transmission from state $\{ \ldots, P_j = X, \ldots \}$, divided by the probability of a data transmission from state $\{ \ldots, P_j = X + 1, \ldots \}$. $l_{\eta_t}$ represents the number of competing nodes on the transition probability, where the subscript \emph{a} refers to the ACK transmission and \emph{d} refers to the data transmission. The $\alpha$ in Equation (\ref{eq:onedimension}) corresponds to state changes from previous traversals in other dimensions. Assuming that we traverse dimensions in ascending order it will be given by

\begin{displaymath}
\alpha_{j} = (\sum_w^{j-1}{i_w})
\end{displaymath}

Using Equation (\ref{eq:onedimension}) we obtain the state probabilities as follows,

\begin{equation}
\label{eq:stateprob}
\pi(I) = (\prod_{j=1}^{n} \phi_{j, i_j}) \pi(0,\ldots,0) =  \beta_I \pi(0,\ldots,0)
\end{equation}

The total probability must equal to one,

\begin{equation}
\label{eq:totalproba}
\pi({0,\ldots,0}) = \frac{1}{\sum_{w_1=0}^{W_1}\ldots\sum_{w_n=0}^{W_n} \beta_{\{w1,\ldots,w_n\}}}
\end{equation}

Using Equations (\ref{eq:stateprob}) and (\ref{eq:totalproba}) we show a closed form solution of $\pi(I)$ as follows,

\begin{equation}
\label{eq:closedformsolution}
\pi(I) = \frac{\beta_I}{\sum_{w_1=0}^{W_1}\ldots\sum_{w_n=0}^{W_n} \beta_{\{w1,\ldots,w_n\}}}
\end{equation}

From Equation (\ref{eq:closedformsolution}) the throughput (\emph{$T_j$}) of flow $j$ can be calculated as follows,

\begin{equation}
\label{eq:throughput}
T_j = \sum_{w_1=0}^{W_1}\ldots\sum_{w_j=1}^{W_j}\ldots\sum_{w_n=0}^{W_n} [\frac{w_j}{l_{\eta}.k_j.\sum_{y=1}^{n} w_y} \pi(w_1,\ldots,w_n)]
\end{equation}

Obtaining the fairness measure is straightforward by applying Equation (\ref{eq:throughput}) to the desired fairness model.

An interesting observation can be obtained from the analysis as follows. The number of transmission steps does not affect the state probabilities obtained by Equation (\ref{eq:closedformsolution}). This leads to a special symmetry between the model's states that can be intuitively predicted from the aforementioned observation that the process can be represented by either the number of data or ACK packets. This symmetry is represented by
\begin{equation}
\label{eq:dataacksymmetry}
\pi( P_1, \ldots, P_i, \ldots ) = \pi( W_1 - P_1, \ldots, W_i - P_i, \ldots )
\end{equation}

We examine the case where flows have identical congestion windows. This is of special interest due to the limit imposed by TCP's receiver window, leading congestion window values to converge to the same value in the equilibrium state. This introduces an additional symmetry in our model. Examining Equation (\ref{eq:closedformsolution}) for the case of identical congestion windows leads to the identity

\begin{equation}
\label{eq:samecwidentity}
\begin{split}
P( \{i_1,\ldots, i_n\} ) = & \left. P( \{y_1,\ldots, y_n\} ) \right. \\
				   & \left. , \forall_{i, y \in S} (freq_I(s_j) = freq_Y(s_j); s_j \in S) \right.
\end{split}
\end{equation}

The term $freq_S(e)$ denotes the frequency of element $e$ in $S$. The identity in Equation (\ref{eq:samecwidentity}) can further simplify studying the throughput relationship between different flows. Examining Equation (\ref{eq:throughput}) for the case of identical congestion windows we notice that all flows have the same number of states that lead to a data transmission. Using the identity in Equation (\ref{eq:samecwidentity}) we know that each state has other \emph{mirroring} states with the same probability. The number of these mirroring states is a multiple of the number of flows. Furthermore, we notice that for these mirroring states, the factors affecting the contribution to throughput is the number of data packets of the flow under consideration and the number of transmission steps (\emph{i.e.,} $k_j$). The number of transmission steps is independent from the summations and only affect the throughput linearly. Given our identity, the sum of the contribution of any set of \emph{mirroring} states is the same for all participating flows. Thus, the relative throughput of two flows with the same congestion window can be calculated as follows,

\begin{equation}
\label{eq:samecw}
\frac{T_i}{T_y} = \frac{\frac{\lambda_i}{k_i}}{\frac{\lambda_y}{k_y}} = \frac{k_y}{k_i}
\end{equation}

Where $\lambda_j$ is Equation \ref{eq:throughput} while taking the transmission steps ($k_j$) outside the summations. Equation (\ref{eq:samecw}) shows that if two flows with the same congestion window compete for channel access, their relative throughput depends only on the number of transmission steps.

\section{Timestamp-ordered MAC}
\label{sec:TMAC}

We conclude from our discussion in Section~\ref{sub:study} that fairness is affected by two factors, namely the difference in congestion window, and the number of transmission steps for each flow. Thus, one way to achieve fairness is by eliminating these two factors. We propose a MAC-layer solution to minimize the difference in the congestion window between various flows and to force a transmitted packet to reach its destination atomically (\emph{i.e.,} make the number of transmission steps equal to one).

Timestamp-ordered MAC (TMAC)~\cite{FNawabICCCN} is a packet scheduling algorithm over 802.11 that prioritizes packets according to their age. It uses request/grant control messages to enforce scheduling between neighboring nodes. A TMAC node schedules a transmission by first polling its child nodes (\emph{i.e.,} nodes one hop farther from the gateway). It sends a request message containing the priority of the packet at the head of its local queue. A child node responds with a grant message if the parent node's packet has a higher priority than its own local packets. The parent can proceed with a transmission only after receiving grant messages from all child nodes. Figure~\ref{fig:multicastMsg} shows how the control frames are scheduled for a transmitter and receiver with three neighboring nodes $N_1$, $N_2$, and $N_3$. Each node maintains a separate queue for data and ACK packets. Data packets are queued according to their age and ACK packets are queued in a round-robin fashion.

\begin{figure}[h]
\centering
\includegraphics[scale=0.55]{img/multicastMsg.eps}
\caption{Multicasting control frames in IEEE 802.11 radios}
\label{fig:multicastMsg}
\end{figure}

TMAC packet scheduling overcomes the various causes for unfairness as inferred from our model. The first cause of unfairness is the difference in congestion window size between various flows. However, flows converge to the value of TCP's receiver window, and hence have identical window size. Second, as per our prior discussion, if flows have identical congestion windows, the only factor of unfairness is the number of transmission steps. This can be overcome by making the transmissions from a node to a gateway an atomic operation. This is achieved by scheduling packets based on their age, since an older packet has a higher priority than younger packets regardless of the difference in the number of hop counts. To overcome the uneven distribution of resources across different branches, ACK packets are scheduled in a round-robin fashion. The explicit polling of \emph{child} nodes help overcome starvation. 


\section{Analysis and Evaluation}\label{sec:eval}
In this section we present a simulation study to validate our proposed model. We also show the performance characteristics of TMAC. We use the NS-3 network simulator with the simulation parameters shown in Table~\ref{tab:parameters}. We account for the initial network transients by discarding the first 20 sec. of simulation data.

\begin{table}[!ht]
\begin{center}
\begin{tabular}{l|c} \hline
  Parameter & Value \\ \hline \hline
  Link rate & 12 Mb/s \\ \hline
  Duration & 120 sec. \\ \hline
  MAC protocol & IEEE 802.11a \\ \hline
  Packet size & 1500 B \\ \hline
  Interface queue size & 500 packets \\ \hline
  Routing protocol & OLSR \\ \hline
%  Traffic source & Backlogged TCP \\ \hline
\end{tabular}
\caption{Simulation parameters}
\label{tab:parameters}
\end{center}
\end{table}


\subsection{Model Validation}
We performed a set of experiments on several parking lot and grid topologies to validate our model. We used our model to numerically calculate the expected rate of each flow. This rate is then scaled by the maximum achievable throughput for a single flow over a one-hop network, shown in Table~\ref{tab:TMAC-CSMA}.


\begin{table}[!ht]
\begin{center}
\begin{tabular}{c|c} \hline
  Link rate & CSMA (Mb/s) \\ \hline \hline
%  1 Mb/s & 729 & 740 \\ \hline
  12 Mb/s & 8.5 \\ \hline
\end{tabular}
\caption{Measured optimal goodput for a TCP flow in a 1-hop network}
\label{tab:TMAC-CSMA}
\end{center}
\end{table}


Our first set of experiments is performed on a two-hop parking lot topology. The maximum congestion window of each flow is varied in both the simulation and model. Our results are shown in Figure~\ref{fig:vary_CW}. The model predicts the experimental results closely. We performed an additional set of experiments without limiting the congestion window. Since congestion windows converge to TCP's receiver window, these results were approximately identical to those obtained by limiting the maximum congestion window size for the two flows to the same value.

\begin{figure}[h]
\centering
\includegraphics[scale=0.62]{img/vary_2hops.eps}
\caption{Numerical results obtained from the model vs. simulation results for a 2-hops parking lot topology}
\label{fig:vary_CW}
\end{figure}

We next experiment with larger topologies, including a four-hop parking lot topology and a 2x2 grid topology. Our results are shown in Figures~\ref{fig:vary_chain4} and~\ref{fig:vary_grid2x2}, averaged over the equilibrium period. In Figure~\ref{fig:vary_chain4} the closest node~(\emph{i.e.}, node 3) has a transmission step of one while other nodes have a transmission step of two. Simulation results show that node~3 achieves twice the throughput as other nodes. In our 2x2 grid topology, nodes~2 and 3 are one-hop away from the gateway while node~1 is two-hop away and relays its traffic via node~3. This network has two branches, one consisting of node~2 and another containing node~1 and 3. Our simulation results show that the cumulative throughput values of nodes in each branch are equal. Furthermore, node~1 achieves half the throughput of node~3 as predicted by our model.

\begin{figure}[h]
\centering
\includegraphics[scale=0.62]{img/vary_chain_4hops.eps}
\caption{Numerical results obtained from the model vs. simulation results for a 4-hops parking lot topology}
\label{fig:vary_chain4}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[scale=0.62]{img/vary_grid_2x2grid.eps}
\caption{Numerical results obtained from the model vs. simulation results for a 2x2 grid topology.}
\label{fig:vary_grid2x2}
\end{figure}

\subsection{Performance of TMAC}
We now present an evaluation of our proposed scheduling algorithm, TMAC. We define a {\it network utilization} metric as $\sum_{i=1}^{N} x_{i} \times h_i$, where $h_i$ is the number of hops along the routing path between the $i^{th}$ node and the gateway. We compared our results to the optimal fair results calculated using our numerical model. Calculating the optimal results using our model is in accordance with Jun and Sichitiu capacity model~\cite{JJun03}. The optimal link capacity is assumed to be the goodput of a single-hop TCP flow in isolation. This capacity is shown in Table~\ref{tab:TMAC-CSMA}.

We have performed a number of simulations to evaluate the fairness of TMAC.  Results obtained from experiments on parking lot topologies are summarized in Table~\ref{tab:TMAC-parkinglots}.

\begin{table}[!ht]
\begin{center}{
\begin{tabular}{l|c|c} \hline
  Scenario & Norm. Network Utilization & JFI \\ \hline \hline
  2-hops & 93.38\%  & 0.999 \\ \hline
  3-hops & 93.35\%  & 0.999 \\ \hline
  4-hops & 94.20\%  & 0.999 \\ \hline
  5-hops & 93.04\%  & 0.999 \\ \hline
  6-hops & 93.80\%  & 0.998 \\ \hline
\end{tabular}
}
\caption{TMAC over parking lot topologies with 12 Mb/s links}
\label{tab:TMAC-parkinglots}
\end{center}
\end{table}

As shown in Table~\ref{tab:TMAC-parkinglots}, achieves fairness with a JFI~\cite{RJain84} of at least 0.998 while maintaining a channel utilization around 93\% for parking lot topologies TMAC. Results for grid topologies in Table~\ref{tab:TMAC-grid} show that TMAC achieves fairness while maintaining more than 90\% of the channel.


\begin{table}[!ht]
\begin{center}
\begin{tabular}{l|c|c} \hline
  Grid size & Norm. Network Utilization & JFI \\ \hline \hline
  2x2 & 92.42\% & 0.999 \\ \hline
  3x3 & 91.17\% & 0.992 \\ \hline
  4x4 & 90.18\% & 0.993 \\ \hline
\end{tabular}
\caption{TMAC results for grid topologies with 12 Mb/s links}
\label{tab:TMAC-grid}
\end{center}
\end{table}

\section{Conclusions and Future Work}\label{sec:conclusions}
We present an analytical model to evaluate TCP throughput fairness over 802.11-based WMNs. Our model captures the interaction between multiple TCP streams and 802.11 MAC protocol. This is done by focusing on the relative flow utilization of the cumulative network queue. The multi-hop effect on TCP performance is modeled by embedding the number of transmission steps affecting the modeled queues. We then propose TMAC, a distributed MAC protocol to overcome the unfairness characteristics of 802.11 in multi-hop networks. TMAC effectively addresses the various causes of unfairness as observed in our model. We performed a simulation evaluation to validate the model and found that it can accurately predict flow throughput. Further experiments were performed on TMAC to confirm its fairness. TMAC is found to achieve resource allocation fairness in parking lot and grid topologies while maintaining over 90\% of maximum link capacity.

We are currently investigating extending the use of this model to propose WMN-aware protocols in other layers of the protocol stack. Transport-layer protocols are a potential candidate for such work, {\em e.g.,} TCP's congestion control mechanism may be adapted to support the fairness requirements. The proposed model and the derived throughput equations can be formulated as an optimization problem to achieve fairness by limiting the congestion windows. This will enable us to achieve fairness by applying modifications to the gateway only. However, it is necessary to obtain real-time information and perform the optimization on the fly.


\begin{thebibliography}{10}
\bibitem {NAbramson70} N. Abramson, ``The ALOHA System: Another Alternative for Communications'', \emph{In Proc. of AFIPS FJCC}, pp. 281--285, 1970.
\bibitem {GBianchi00} G. Bianchi, ``Performance Analysis of the IEEE 802.11 Distributed Coordination Function'', \emph{IEEE Journal on Selected Areas in Communication}, Vol. 18, No. 3, pp. 535--547, 2000.
\bibitem {RBoorstyn87} R. Boorstyn, A. Kershenbaum, B. Maglaris, V. Sahin, ``Throughput Analysis in Multihop CSMA Packet Radio Networks'', \emph{IEEE Transactions on Communications}, Vol. 35, No. 3, pp. 267--274, 1987.
\bibitem {VGambiroza04} V. Gambiroza, B. Sadeghi, and E. W Knightly, ``End-to-end performance and fairness in multi-hop wireless backhaul networks'', \emph{In Proc. of the ACM MobiCom}, pp. 287--301, 2004.
\bibitem {MGaretto08} M. Garetto, T. Salonidis, E. W. Knightly, ``Modeling per-flow throughput and capturing starvation in CSMA multi-hop wireless networks'', \emph{IEEE/ACM Transactions on Networking}, Vol. 16, No. 4, pp. 864--877, 2008.
\bibitem {RJain84} R. K. Jain, D-M. Chiu, and W. R. Hawe, ``A quantitative measure of fairness and discrimination for resource allocation in shared computer system'', \emph{DEC Research Report TR-301}, 1984.
\bibitem {JJun03} J. Jun, M. L. Sichitiu, ``The nominal capacity of Wireless Mesh Networks'', \emph{IEEE Wireless Communications}, Vol. 10, No. 5, pp. 8--14, 2003.
\bibitem {AKherani04} A. Kherani, R. Shorey, ``Throughput Analysis of TCP in Multi-Hop Wireless Networks with IEEE 802.11 MAC'', \emph{In Proc. of IEEE WCNC}, pp. 237--242, 2004.
\bibitem {FNawabICCCN} F. Nawab, K. Jamshaid, B. Shihada, P-H. Ho, ``TMAC: Timestamp-ordered MAC for CSMA/CA Wireless Mesh Networks'', \emph{In Proc. of the IEEE ICCCN}, 2011.
\bibitem {SPilosof03} S. Pilosof, R. Ramjee, D. Raz, Y. Shavitt, P. Sinha, ``Understanding TCP fairness over Wireless LAN'', \emph{In Proc. of IEEE INFOCOM}, pp. 863--872, 2003.

\end{thebibliography}

\end{document}
